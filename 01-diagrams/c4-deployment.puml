@startuml C4_Deployment
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Deployment.puml

LAYOUT_WITH_LEGEND()

title Deployment Diagram - SmartHomeHubDoeb

Deployment_Node(azure, "Microsoft Azure", "Cloud Platform") {
    Deployment_Node(region, "France Central", "Azure Region") {
        Deployment_Node(rg, "IOTProject", "Resource Group") {
            
            Deployment_Node(vm, "SmartHomeHubDoeb", "Azure VM\nUbuntu 24.04 LTS\nStandard_B1s\n1 vCPU, 1GB RAM") {
                
                Deployment_Node(docker, "Docker Engine", "Container Runtime") {
                    
                    Container(mqtt_container, "smarthome-mqtt", "Eclipse Mosquitto 2.0", "MQTT Broker\nPorts: 1883, 9001")
                    
                    Container(api_container, "smarthome-api", "Python 3.11 + Flask", "REST API + WebSocket\nPort: 7071 â†’ 80")
                }
                
                Deployment_Node(storage, "Volumes", "Docker Volumes") {
                    ContainerDb(mqtt_data, "mosquitto/data", "MQTT Persistence")
                    ContainerDb(dashboard_files, "dashboard/", "HTML/CSS/JS")
                }
            }
            
            Deployment_Node(nsg, "Network Security Group", "Firewall Rules") {
                Component(rule_ssh, "SSH", "Port 22")
                Component(rule_http, "HTTP", "Port 80")
                Component(rule_mqtt, "MQTT", "Port 1883")
            }
            
            Deployment_Node(pip, "Public IP", "40.66.52.113") {
            }
        }
    }
}

Deployment_Node(user_device, "User Device", "PC/Laptop/Phone") {
    Container(browser, "Web Browser", "Chrome/Firefox/Edge", "Dashboard access")
}

Deployment_Node(iot_network, "Home Network", "Local IoT Devices") {
    Container(sensors, "IoT Sensors", "ESP32/Arduino", "Temperature, Motion, Door sensors")
}

Rel(browser, pip, "HTTPS/WebSocket", "Port 80")
Rel(sensors, pip, "MQTT", "Port 1883")
Rel(pip, vm, "Routes traffic")
Rel(api_container, mqtt_container, "MQTT", "Internal network")
Rel(api_container, dashboard_files, "Serves")
Rel(mqtt_container, mqtt_data, "Persists")

@enduml

